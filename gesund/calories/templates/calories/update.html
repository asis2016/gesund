{% extends 'base.html' %}
{% load static %}

{% block main %}
    <div class="container-fluid calories-container-update" id="calories-container">
        <div class="row row-first">
            <div class="col-lg-12">
                <div class="col-page-header">
                    <h2>Calorie Intake</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="#">Tracker</a></li>
                            <li class="breadcrumb-item active" aria-current="page">
                                Add food
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>

        <div class="row row-second">
            <div class="col-lg-6 mt-4 col-first">
                <div class="card">
                    <div class="card-header card-header-menu">
                        Update your food intake
                    </div>
                    <form method="POST">
                        {% csrf_token %}
                        <div class="card-body">
                            <!--Datestamp-->
                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label" for="id_datestamp">
                                    Datestamp
                                </label>
                                <div class="col-sm-6">
                                    <input autocomplete="off"
                                           class="form-control"
                                           id="id_datestamp"
                                           name="datestamp"
                                           value="{{ calories_obj.datestamp|date:'Y-m-d' }}"
                                           readonly>
                                </div>
                            </div>

                            <!-- Food -->
                            <div class="form-group row mt-3 form-group-id">
                                <label class="col-sm-4 col-form-label" for="id_food">
                                    Food
                                </label>
                                <div class="col-sm-6">
                                    <input autocomplete="off"
                                           class="form-control"
                                           id="id_food"
                                           name="food"
                                           type="text"
                                           value="{{ calories_obj.food }}"
                                           readonly>
                                </div>
                            </div>
                            <!-- Food -->
                            <div class="form-group row mt-3 form-group-id">
                                <label class="col-sm-4 col-form-label" for="id_consume">
                                    Consumption (gm)
                                </label>
                                <div class="col-sm-6">
                                    <input autocomplete="off"
                                           class="form-control"
                                           id="id_consume"
                                           name="consume"
                                           required
                                           step="any"
                                           type="number"
                                           value="{{ calories_obj.consume }}">
                                </div>
                            </div>
                            <!-- Food id -->
                            <input type="text"
                                   id="id_food"
                                   name="food_detail_ref"
                                   class="d-none"
                                   value="{{ calories_obj.food_detail_ref }}">
                            <hr>
                            <div class="form-group row mt-2">
                                <!-- calories -->
                                <div class="col">
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_calories">
                                            Calories
                                        </label>
                                        <div class="col-sm-6">
                                            <input autocomplete="off"
                                                   class="form-control"
                                                   id="id_calories"
                                                   name="calories"
                                                   step="any"
                                                   type="number"
                                                   value="{{ calories_obj.calories }}">
                                        </div>
                                    </div>
                                </div>

                                <!-- protein -->
                                <div class="col">
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_protein">
                                            Protein
                                        </label>
                                        <div class="col-sm-6">
                                            <input autocomplete="off"
                                                   class="form-control"
                                                   id="id_protein"
                                                   name="protein"
                                                   placeholder="1.0"
                                                   step="any"
                                                   type="number"
                                                   value="{{ calories_obj.protein }}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group row mt-3">
                                <!-- fat -->
                                <div class="col">
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_fat">
                                            Fat
                                        </label>
                                        <div class="col-sm-6">
                                            <input autocomplete="off"
                                                   class="form-control"
                                                   id="id_fat"
                                                   name="fat"
                                                   step="any"
                                                   type="number"
                                                   value="{{ calories_obj.fat }}">
                                        </div>
                                    </div>
                                </div>
                                <!-- carb -->
                                <div class="col">
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_carb">
                                            Carb
                                        </label>
                                        <div class="col-sm-6">
                                            <input autocomplete="off"
                                                   class="form-control"
                                                   id="id_carb"
                                                   name="carb"
                                                   step="any"
                                                   type="number"
                                                   value="{{ calories_obj.carb }}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group row mt-3">
                                <div class="col">
                                    <!-- sugar -->
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_sugar">
                                            Sugar
                                        </label>
                                        <div class="col-sm-6">
                                            <input autocomplete="off"
                                                   class="form-control"
                                                   id="id_sugar"
                                                   name="sugar"
                                                   step="any"
                                                   type="number"
                                                   value="{{ calories_obj.sugar }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <!-- fiber -->
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_fiber">
                                            fiber
                                        </label>
                                        <div class="col-sm-6">
                                            <input autocomplete="off"
                                                   class="form-control"
                                                   id="id_fiber"
                                                   name="fiber"
                                                   step="any"
                                                   type="number"
                                                   value="{{ calories_obj.fiber }}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr>
                            <div class="form-group row mt-3">
                                <div class="col">
                                    <!-- description -->
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label" for="id_sugar">
                                            Description
                                        </label>
                                        <div class="col-sm-6">
                                            <input type="text"
                                                   id="id_description"
                                                   name="description"
                                                   class="d-none"
                                                   value="{{ calories_obj.description }}">
                                            <p>
                                                {{ calories_obj.description }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <!-- food_detail_ref-->
                            <input type="text" name="food_detail_ref" value="{{ calories_obj.food_detail_ref.id }}"
                                   class="d-none">
                            <!-- -->
                            <button class="btn btn-warning" type="submit">
                                <i class="fa-solid fa-pen-to-square"></i>
                                <span class="p-2">Update changes</span>
                            </button>
                            <!-- go back -->
                            <a class="float-end go-back-to-list go-back-lg"
                               href="{% url 'calorie-intake-datestamp-collection-index' calories_obj.datestamp|date:'Y-m-d' %}">
                                Go back to the calorie intake
                            </a>
                            <a class="btn btn-secondary go-back-sm"
                               href="{% url 'calorie-intake-datestamp-collection-index' calories_obj.datestamp|date:'Y-m-d' %}">
                                <i class="fa-solid fa-angle-left"></i>
                                <span class="p-2">Go back</span>
                            </a>
                            <!-- go back ends -->
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="spacer mb-4"></div>
    </div>
{% endblock main %}

{% block scripts %}
    <script>
        $(document).ready(() => {
            const REST_API_URL = '{{ REST_API_URL }}'
            const id = '{{ calories_obj.id }}'
            let calories = ''
            let protein = ''
            let fat = ''
            let carb = ''
            let sugar = ''
            let fiber = ''
            let description = ''

            /**
             * Document ready load ajax!
             * */
            $.ajax({
                //url:  + "food-calories/" + food_id,
                url: `${REST_API_URL}/food-calories/${id}`,
                type: "GET",
                success: (response) => {
                    calories = response.calories
                    protein = response.protein
                    fat = response.fat
                    carb = response.carb
                    sugar = response.sugar
                    fiber = response.fiber
                }
            })

            /**
             * Updating consumption per gm.
             * */
            $("#id_consume").keyup(() => {
                consume = $("#id_consume").val()

                /**
                 * calculate consumption */
                const calcConsumption = (qty) => {
                    return ((qty / 100) * consume).toFixed(2)
                }

                $("#id_calories").val(calcConsumption(calories))
                $("#id_protein").val(calcConsumption(protein))
                $("#id_fat").val(calcConsumption(fat))
                $("#id_carb").val(calcConsumption(carb))
                $("#id_sugar").val(calcConsumption(sugar))
                $("#id_fiber").val(calcConsumption(fiber))
            })

            // Clear
            $("#clear-search").click(() => {
                console.log('clicking...')
                $("#id_search").val('')
                $("#id_search-label").text('')
                $("#id_id").val('')
                $("#id_description").text('')
                $("#id_calories").val('')
                $("#id_protein").val('')
                $("#id_fat").val('')
                $("#id_carb").val('')
                $("#id_sugar").val('')
                $("#id_fiber").val('')
                $("#id_category").val('')
                return false
            })
        })
    </script>
{% endblock scripts %}